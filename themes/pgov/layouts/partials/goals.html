{{ $logos := resources.Match "images/agencies/seals/*" }}
{{ $item := getJSON "/data/target.json" }}   

{{ $codes := dict "key" "value" }}
{{ range .Site.Data.codes }}
    {{ $codes = merge $codes (dict .Code .Name) }}
{{ end }}


<!-- Search bar -->
<div class="relative z-0 flex flex-1 items-center justify-center px-2">
  <div class="w-full max-w-7xl mt-6">
    <label for="search" class="sr-only">Search</label>
    <div class="relative">
      <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
        <svg class="h-5 w-5 text-zinc-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
        </svg>
      </div>
      <input id="search" name="search" class="block w-full rounded-full border-0 bg-slate-100 py-1.5 pl-10 pr-3 text-zinc-300 placeholder:text-zinc-400 focus:bg-white focus:text-zinc-900 focus:ring-0 focus:placeholder:text-zinc-500 sm:text-sm sm:leading-6" placeholder="Search" type="search">
    </div>
  </div>
</div>


<!-- Agencies filter dropdown -->
<!-- <div class="flex flex-row relative justify-center lg:max-w-7xl mt-2 mx-auto">
  <div class="flex relative rounded-md relative">
  <button type="button" class="relative inline-flex items-center rounded-l-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 focus:z-10" style="width:255px">Agencies</button>
  <button type="button" onClick="closeAgenciesFilterDropdown()" class="relative inline-flex items-center rounded-r-md bg-white px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-10" id="option-menu-button" aria-expanded="true" aria-haspopup="true">
    <span class="sr-only">Open options</span>
    <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
      <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
    </svg>
  </button>

  <div class="absolute -ml-px block">    
      <div class="agencies-filter hidden absolute z-10 -mr-1 mt-10 w-64 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="option-menu-button" tabindex="-1">
        <div class="py-1 h-72 overflow-auto" role="none"> 
          {{ range .Site.Data.codes }}
            <a href="#" id="{{ .Name }}" onClick="agencies_filter()" class="select-agency text-gray-700 block px-4 py-2 text-sm hover:bg-slate-200" role="menuitem" tabindex="-1" id="option-menu-item-0">{{ .Name }}</a>
          {{ end }}
        </div>
      </div>
  </div>
</div> -->

  <!-- Goal Status filter dropdown -->
  <!-- <div class="flex relative rounded-md relative">
    <button type="button" class="relative inline-flex items-center rounded-l-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 focus:z-10 ml-2.5" style="width:255px">Goal Status</button>
    <button type="button" onClick="closeGoalFilterDropdown()" class="relative inline-flex items-center rounded-r-md bg-white px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-10" id="option-menu-button" aria-expanded="true" aria-haspopup="true">
      <span class="sr-only">Open options</span>
      <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
      </svg>
    </button>
  
    <div class="absolute -ml-px block">    
        <div class="goals-filter hidden absolute z-10 -mr-1 mt-10 ml-2.5 w-64 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="option-menu-button" tabindex="-1">
          <div class="py-1 h-72 overflow-auto" role="none"> 
            {{ range .Site.Data.goals }}
              <a href="#" id="{{ .Name }}" class="select-agency text-gray-700 block px-4 py-2 text-sm hover:bg-slate-200" role="menuitem" tabindex="-1" id="option-menu-item-0">{{ .goal_status }}</a>
            {{ end }}
          </div>
        </div>
    </div>
  </div>
</div> -->


<!-- Filter Tags -->
<div class="flex justify-center pt-6 space-x-4">
    <button id="All" onClick="category_click(this.id)" class="tag w-16 justify-center text-center border border-sky-900 hover:bg-sky-900 hover:text-white inline-flex items-center rounded-full px-2 py-1 text-xs font-medium text-sky-950 ring-1 ring-inset ring-gray-500/10">All</button>
    <button id="Climate" onClick="category_click(this.id)" class="tag w-16 justify-center text-center border border-sky-900 hover:bg-sky-900 hover:text-white inline-flex items-center rounded-full bg-gray-50 px-2 py-1 text-xs font-medium text-sky-950 ring-1 ring-inset ring-gray-500/10">Climate</button>
    <button id="Equity" onClick="category_click(this.id)" class="tag w-16 justify-center text-center border border-sky-900 hover:bg-sky-900 hover:text-white inline-flex items-center rounded-full bg-gray-50 px-2 py-1 text-xs font-medium text-sky-950 ring-1 ring-inset ring-gray-500/10">Equity</button>
    <button id="Economic development, Economic security & policy" onClick="category_click(this.id)" class="tag w-18 justify-center text-center border border-sky-900 hover:bg-sky-900 hover:text-white inline-flex items-center rounded-full bg-gray-50 px-2 py-1 text-xs font-medium text-sky-950 ring-1 ring-inset ring-gray-500/10">Economy</button>
    <button id="Domestic health, Global health, Medicare" onClick="category_click(this.id)" class="tag w-18 justify-center text-center border border-sky-900 hover:bg-sky-900 hover:text-white inline-flex items-center rounded-full bg-gray-50 px-2 py-1 text-xs font-medium text-sky-950 ring-1 ring-inset ring-gray-500/10">Healthcare</buttonn>    
</div>

<!-- Card Component-->
<div id="all-cards" >
    <div class="mx-auto max-w-2xl px-4 py-16 sm:px-6 sm:py-16 lg:max-w-7xl lg:px-8" >
      <p id="output" class="text-right sans text-sm text-slate-600 font-medium">90 of 90 total results</p>
      <div class="mt-6 grid grid-cols-1 gap-x-6 gap-y-10 sm:grid-cols-2 lg:grid-cols-3 xl:gap-x-8">
        {{ range .Site.Data.goals }}
          {{ if eq .goal_type "APG" }}
              <!-- <div class="bg-white cards rounded-2xl" > -->
                {{ $goal_description_string := printf "%s" .goal_description }}
                  <div class="group relative cards"  onClick="cardPopup()" name="All, {{ .applied_tags }}" data-value="{{ index $codes .agency_code }}">
                      <div dir="ltr" style="height:406px;" class="bg-white border border-slate-300 rounded-2xl min-h-80 aspect-h-1 aspect-w-1 w-full overflow-hidden lg:aspect-none group-hover:opacity-75">                           
                        <div class="grid" style="grid-template-columns: 267px 190px;">                                                                   
                          {{ if eq .goal_type "APG" }}
                          <span style="width:fit-content; height:26px; font-family: 'Public Sans', sans-serif;" class="inline-flex items-center rounded-full bg-gray-50 px-2 py-0.5 text-sm font-medium text-gray-700 ring-1 ring-inset ring-gray-500/10 ms-6 my-4">2YRGoal</span>
                          {{ end }}
                          <span id="cardStatus" style="width:fit-content; height:26px; margin-left:0; font-family: 'Public Sans', sans-serif;" class="status inline-flex items-center gap-x-1.5 rounded-full bg-gray-100 px-2 py-1 text-sm font-medium text-slate-700 ms-8 my-4" data-value="{{ .goal_status }}">
                            <svg class="h-1.5 w-1.5 fill-blue-500" viewBox="0 0 6 6" aria-hidden="true"><circle cx="3" cy="3" r="3" /></svg>
                              {{ .goal_status }}
                              <a href="{{ .url_pgov_agency_12 }}" id="hidden-goal-link"></a>
                          </span>
                        </div>    
                        <p id="cardName"  class="text-lg ms-6 mx-4 my-2 font-semibold" data-value="{{ .goal_name }}" style="font-family: 'Public Sans', sans-serif;">{{ .goal_name | truncate 64 }}</p> 
                        <p id="cardDescription" class="text-base mx-6 my-4 text-slate-900" data-value="{{ .goal_description }}" style="font-family: 'Public Sans', sans-serif;">{{ .goal_description | truncate 165 }}</p>
                        <hr style="width:88%; margin:auto;" class="border-slate-300"/>
                        <div class="flex flex-row mx-6 mb-2 mt-3">
                          <i class="fa-solid fa-people-group mr-2 mt-1"></i>
                          <p class="text-base font-semibold mr-2" style="font-family: 'Public Sans', sans-serif;">Leaders</p>
                          <div class="flex -space-x-1 overflow-hidden ml-auto">
                            <img class="inline-block h-6 w-6 rounded-full ring-2 ring-white" src="https://images.unsplash.com/photo-1491528323818-fdd1faba62cc?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">
                            <img class="inline-block h-6 w-6 rounded-full ring-2 ring-white" src="https://images.unsplash.com/photo-1550525811-e5869dd03032?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">
                            <img class="inline-block h-6 w-6 rounded-full ring-2 ring-white" src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2.25&w=256&h=256&q=80" alt="">
                            <img class="inline-block h-6 w-6 rounded-full ring-2 ring-white" src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">
                          </div>
                        </div>
                        <hr style="width:88%; margin:auto;" class="border-slate-300"/>
                        <div class="flex flex-row mx-6 mt-3 mb-2">
                          <i class="fa-regular fa-calendar mr-2 mt-1"></i>
                          <p class="text-base font-semibold mr-3 text-slate-900" style="font-family: 'Public Sans', sans-serif;">Duration</p>
                          <div class="flex -space-x-1 overflow-hidden ml-auto">
                            {{ $startYrStr := printf "%s" .date_start_fy }}
                            {{ $endYrStr := printf "%s" .date_end_fy }}
                            {{ $shortStartYr := substr $startYrStr 2 }}
                            {{ $shortEndYr := substr $endYrStr 2 }}
                            <p class="text-base text-slate-600" style="font-family: 'Public Sans', sans-serif;">FY{{ $shortStartYr }}-{{ $shortEndYr }}</p>                      
                          </div>
                        </div>
                        <hr style="width:88%; margin:auto;" class="border-slate-300"/>
                        <div class="flex flex-row mx-6 mt-3 mb-4">
                          <i class="fa-solid fa-list-check mr-2 mt-1"></i>
                          <p class="text-base font-semibold mr-2 text-slate-900" style="font-family: 'Public Sans', sans-serif;">Targets</p>
                          <div class="flex -space-x-1 overflow-hidden ml-auto">
                            <p class="text-base text-slate-600" style="font-family: 'Public Sans', sans-serif;">Add text here</p>                      
                          </div>
                        </div>
                      </div>    
                      <div class="flex">  
                          {{ $lowercaseOrg := lower .organization_abbreviation }}                                            
                          {{ range $index, $logo := $logos }}  
                            {{ $imgAlt := path.Base $logo.Name }}
                            {{ $removeImgType := replaceRE `(\.[^.]+)$` "" $imgAlt }}     
                              {{ if eq $removeImgType $lowercaseOrg }}                       
                                  <img src="{{ $logo.Permalink }}" alt="{{ $removeImgType }}" style="width:37px; height:37px;" class="mx-2 my-3"/>                                                                         
                              {{ end }}
                            {{ end }}                       
                        <p id="cardAgency" name="{{ index $codes .agency_code }}" class="agency-name font-semibold text-base ml-1 my-5 inline-block text-slate-900" style="font-family: 'Public Sans', sans-serif;">{{ index $codes .agency_code }}</p>                                       
                        <p class="hidden hidden-abbr">{{ $lowercaseOrg }}</p>                   
                            {{ $numbers := (slice 103 144 185 314 713 238 117) }}
                            {{ $shuffled := shuffle $numbers }}
                            {{ range $index, $number := $shuffled }}
                              {{ if mod $index 7 | eq 0 }}
                                <i class="fa-solid fa-eye mt-6 ml-auto mr-1"></i>
                                <span class="my-5 mr-1" style="font-family: 'Public Sans', sans-serif;">{{ index $shuffled $index }}</span>
                              {{ end }}
                            {{ end }}                    
                      </div>  
                   </div>                                                               
              <!-- </div> -->         
              {{ end }}  
                <!-- Renders Overlay -->
                <div id="overlay" class="hidden">
                  <div class="relative z-10" role="dialog" aria-modal="true">
                    <div class="fixed inset-0 hidden bg-gray-500 bg-opacity-75 transition-opacity md:block"></div>
                    <div class="fixed inset-0 z-10 overflow-y-auto">
                      <div class="flex min-h-full items-stretch justify-center text-center md:items-center md:px-2 lg:px-4">
                        <div class="flex w-full transform text-left text-base transition md:my-8 md:max-w-2xl md:px-4 lg:max-w-6xl">
                          <div class="relative flex w-full items-center overflow-hidden bg-white px-4 pb-8 pt-14 shadow-2xl sm:px-6 sm:pt-8 md:p-6 lg:p-8">
                            <div class="absolute right-0 top-0 hidden pr-4 pt-4 sm:block">
                              <button type="button" id="closeOverlay" class="rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                                <span class="sr-only">Close</span>
                                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                              </button>
                            </div>
                            <div   class="sm:flex sm:items-start">
                              <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                                <p class="overlay-goal-agency text-base font-semibold sans my-4 inline-block text-slate-900" style="font-family: 'Public Sans', sans-serif;"></p>
                                <span class="ml-4 overlay-goal-status status inline-flex items-center gap-x-1.5 rounded-md bg-blue-100 px-2 py-1 text-xs font-medium text-blue-700 my-4" style="font-family: 'Public Sans', sans-serif;">
                                  <svg class="h-1.5 w-1.5 fill-blue-500" viewBox="0 0 6 6" aria-hidden="true"><circle cx="3" cy="3" r="3" /></svg>   
                                </span>
                                <h3 class="overlay-goal-name text-xl font-semibold leading-6" id="modal-title" style="font-family: 'Public Sans', sans-serif;"></h3>              
                                <div class="mt-2">
                                  <p class="overlay-goal-description text-base text-slate-900" style="font-family: 'Public Sans', sans-serif;"></p>
                                </div>
                                <a href="" class="overlay-goal-button"><button type="button" class="float-right bg-sky-900 text-white hover:border hover:border-sky-900 hover:text-sky-900 mt-3 inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:w-auto">Go to Goal Profile</button></a>
                              </div>     
                            </div>                                    
                        </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>      
        {{ end }}
      </div>
    </div>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>
  const cards = document.querySelectorAll(".cards");
  const goalAgency = document.querySelector(".overlay-goal-agency");
  const goalName = document.querySelector(".overlay-goal-name");
  const goalStatus = document.querySelector(".overlay-goal-status");
  const goalDescription = document.querySelector(".overlay-goal-description");
  const goalButton = document.querySelector(".overlay-goal-button");
  const overlay = document.querySelector("#overlay");
  const closeOverlay = document.querySelector("#closeOverlay");

  function closeAgenciesFilterDropdown() {
    var filterButton = document.querySelector(".agencies-filter");
    filterButton.classList.toggle("hidden");
  }

  function closeGoalFilterDropdown() {
    var filterButton = document.querySelector(".goals-filter");
    filterButton.classList.toggle("hidden");
  }

  // function showFilter(id) {
  //   var agencySelected = document.querySelectorAll(".select-agency");
  //   var agencyName = document.querySelector("#cardAgency");
  //   var cards = document.querySelector(".cards");

  //   agencySelected.forEach((id) => {
  //     if (id.href === agencyName.innerHTML) {
  //       cards.style.display = 'block';
  //     }
  //   })
  // }
  
  // Display goal details in overlay
  // function cardPopup() {
    // var cards1 = document.querySelectorAll(".cards");
    // var overlays = document.querySelector("#overlay");
    // const closeOverlay1 = document.querySelector("#closeOverlay");
    cards.forEach((card) => {
    card.addEventListener("click", () => {   
      overlay.classList.toggle("hidden");
      goalAgency.textContent = card.querySelector("#cardAgency").innerHTML;
      goalName.textContent = card.querySelector("#cardName").getAttribute("data-value");
      goalStatus.textContent = card.querySelector("#cardStatus").getAttribute("data-value");
      goalDescription.textContent = card.querySelector("#cardDescription").getAttribute("data-value");
      goalButton.href = card.querySelector("#hidden-goal-link").getAttribute("href");
    })
  })
 
  // }
  
  closeOverlay.addEventListener("click", () => {
    overlay.classList.toggle("hidden");
  });


// Perform this function on Agencies filter click
function agencies_filter() {
  filter_hide_all();
  filter_click_agencies();
}

  function filter_hide_all() {
    const var2 = document.querySelectorAll("div[name*=All]");
    var2.forEach((userItem) => {
      userItem.style.display = 'none'
    });
  }

  function filter_click_agencies(){

    const myArray = [];
    const getAgencies = document.querySelectorAll(".select-agency");
    const cards = document.querySelectorAll(".cards");

    // create array of Agency IDs
    getAgencies.forEach((tag) => {
      const getAgencyId = tag.getAttribute("id");   
      myArray.push(getAgencyId);   
    })

    myArray.forEach((item) => {
      console.log(item, "item");
       // const getCardAgency = document.querySelectorAll("div[data-value*=" + item + "]");
      // getCardAgency.forEach((userItem) => {
      //   userItem.style.display = 'block';
      // })
      
    })
  }


   // Perform this function on tag filter click
  function category_click(clicked_id) {
    category_hide_all();
    category_show_clicked(clicked_id);
    category_count();
  }

  // Hide all cards
  function category_hide_all() {
    // Get list of all cards
    const var2 = document.querySelectorAll("div[name*=All]");

    // Hide all cards
    var2.forEach((userItem) => {
      userItem.style.display = 'none'
    });

    // Set filter buttons to default color
    const allFilters = document.querySelectorAll(".tag");
    allFilters.forEach((item) => {
      item.style.backgroundColor = "rgb(249 250 251)";
      item.style.color = "rgb(8 47 73)";
    }) 
  }

  // Show all cards with a tag that was selected
  function category_show_clicked(clicked_id) {
    console.log(clicked_id, "id");
    // Split IDs into array
    const myArray = clicked_id.split(",");

    // Loop through each ID in the array
    myArray.forEach((id) => {
      // Get list of all cards with this ID in its applied tags
      const var1 = document.querySelectorAll("div[name*=" + CSS.escape(id) + "]");
      // Display these cards
      var1.forEach((userItem) => {
        userItem.style.display = 'block'
      });
    });

    // Set clicked filter button to active color
    const filter = document.getElementById(clicked_id);
    filter.style.backgroundColor = "rgb(12 74 110)";
    filter.style.color = "rgb(255 255 255)";
  }

  // Display the number of results
  function category_count() {
    // Get list of all cards
    const var3 = document.querySelectorAll("div[name*=All]");

    // Set variables
    var counter = 0;
    var total = var3.length;

    // Loop all cards and count displayed cards
    var3.forEach((item) => {
      if (item.style.display === 'block') {
        counter = counter + 1;
      }
    }) 

    // Output results
    document.getElementById("output").innerHTML = `${counter} of ${total} total results`;
  }

  // Set goal status designs
  const statuses = document.querySelectorAll(".status");
  statuses.forEach((item) => {
    if(item.innerText === "On Track") {
      item.style.backgroundColor = "rgba(220, 255, 228, 1)";
      item.style.color ="rgb(51 65 85)";
      item.querySelector("svg").style.fill = "rgba(40, 167, 69, 1)";
    } else if (item.innerText === "Unavailable") {
      item.querySelector("svg").style.fill = "rgb(156 163 175)";
    } else if (item.innerText === "Ahead") {
      item.style.backgroundColor = "rgba(241, 248, 255, 1)";
      item.style.color ="rgb(51 65 85)";
      item.querySelector("svg").style.fill = "rgba(3, 102, 214, 1)";
    } else if (item.innerText === "Delayed" || item.innerText === "Blocked") {
      item.style.backgroundColor = " rgba(255, 220, 224, 1)";
      item.style.color ="rgb(51 65 85)";
      item.querySelector("svg").style.fill = "rgba(215, 58, 73, 1)";
    }
  }) 

</script>